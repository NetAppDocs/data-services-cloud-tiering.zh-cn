---
sidebar: sidebar 
permalink: task-tiering-onprem-s3-compat.html 
keywords: data tiering, fabricpool, cloud tiering, tiering cold data, tiering inactive data, tiering aff, tiering fas, tiering ontap, tiering volumes, tier data, tier cold data, tier fas, tier aff, tier ontap, s3, tier to s3, minio 
summary: '通过将非活动数据分层到使用简单存储服务 (S3) 协议的任何对象存储服务，释放本地ONTAP集群上的空间。' 
---
= 将本地ONTAP集群中的数据分层到NetApp Cloud Tiering中的 S3 对象存储
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
通过将NetApp Cloud Tiering中的非活动数据分层到使用简单存储服务 (S3) 协议的任何对象存储服务，释放本地ONTAP集群上的空间。

至此，MinIO对象存储已经合格。

[CAUTION]
====
想要使用未正式支持为云层的对象存储的客户可以按照这些说明进行操作。客户必须测试并确认对象存储满足他们的要求。

NetApp不支持也不对任何第三方对象存储服务引起的任何问题负责，特别是在未与产品来源的第三方达成一致支持安排的情况下。双方承认并同意， NetApp不对任何相关损害负责，也不需为该第三方产品提供支持。

====


== 快速启动

按照以下步骤快速开始，或者向下滚动到其余部分以获取完整详细信息。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-1.png["一个"]准备将数据分层到与 S3 兼容的对象存储
[role="quick-margin-para"]
您需要以下内容：

[role="quick-margin-list"]
* 已添加到NetApp Console的运行ONTAP 9.8 或更高版本的源本地ONTAP集群，以及通过用户指定端口到目标 S3 兼容对象存储的连接。 https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["了解如何发现集群"^] 。
* 对象存储服务器的 FQDN、访问密钥和密钥，以便ONTAP集群可以访问存储桶。
* 在您的场所安装控制台代理。
* 代理的网络可实现与源ONTAP集群、S3 兼容对象存储以及 Cloud Tiering 服务的出站 HTTPS 连接。


.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-2.png["两个"]设置分层
[role="quick-margin-para"]
在控制台中，选择一个本地系统，为分层服务选择*启用*，然后按照提示将数据分层到与 S3 兼容的对象存储。

.image:https://raw.githubusercontent.com/NetAppDocs/common/main/media/number-3.png["三"]设置许可
[role="quick-margin-para"]
通过云提供商的即用即付订阅、云分层自带许可证或两者结合的方式支付云分层费用：

[role="quick-margin-list"]
* 订阅 PAYGO 优惠 https://aws.amazon.com/marketplace/pp/prodview-oorxakq6lq7m4?sr=0-8&ref_=beagle&applicationId=AWSMPContessa["AWS Marketplace"^]， https://azuremarketplace.microsoft.com/en-us/marketplace/apps/netapp.cloud-manager?tab=Overview["Azure 市场"^] ， 或者 https://console.cloud.google.com/marketplace/details/netapp-cloudmanager/cloud-manager?supportedpurview=project&rif_reserved["GCP Marketplace"^]，选择*订阅*并按照提示操作。
* 要使用 Cloud Tiering BYOL 许可证付款，请发邮件至：ng-cloud-tiering@netapp.com?subject=Licensing[如果您需要购买，请联系我们]，然后link:https://docs.netapp.com/us-en/bluexp-digital-wallet/task-manage-data-services-licenses.html["将其添加到NetApp Console"^]。。




== 要求

验证对ONTAP集群的支持、设置网络并准备对象存储。

下图显示了每个组件以及您需要在它们之间准备的连接：

image:diagram_cloud_tiering_s3_compat.png["架构图像显示了 Cloud Tiering 服务与您本地代理的连接、代理与您的ONTAP集群的连接以及ONTAP集群与对象存储之间的连接。活动数据驻留在ONTAP集群上，而非活动数据驻留在对象存储中。"]


NOTE: 代理和 S3 兼容对象存储服务器之间的通信仅用于对象存储设置。



=== 准备ONTAP集群

将数据分层到与 S3 兼容的对象存储时，源ONTAP集群必须满足以下要求。

支持的ONTAP平台:: 您可以从AFF系统或具有全 SSD 聚合或全 HDD 聚合的FAS系统分层数据。
支持的ONTAP版本:: ONTAP 9.8 或更高版本
集群网络要求::
+
--
* ONTAP集群通过用户指定的端口启动与 S3 兼容对象存储的 HTTPS 连接（该端口可在分层设置期间配置）。
+
源ONTAP系统从对象存储读取和写入数据。对象存储从不启动，它只是响应。

* 需要来自代理的入站连接，该代理必须位于您的场所。
+
不需要集群和 Cloud Tiering 服务之间的连接。

* 每个托管要分层的卷的ONTAP节点上都需要一个集群间 LIF。  LIF 必须与ONTAP用于连接对象存储的 _IPspace_ 相关联。
+
当您设置数据分层时，Cloud Tiering 会提示您使用 IP 空间。您应该选择与每个 LIF 关联的 IP 空间。这可能是“默认” IP 空间或您创建的自定义 IP 空间。详细了解 https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["LIF"^]和 https://docs.netapp.com/us-en/ontap/networking/standard_properties_of_ipspaces.html["IP 空间"^]。



--
支持的卷和聚合:: Cloud Tiering 可以分层的卷总数可能少于ONTAP系统上的卷数。这是因为卷不能从某些聚合中分层。请参阅ONTAP文档 https://docs.netapp.com/us-en/ontap/fabricpool/requirements-concept.html#functionality-or-features-not-supported-by-fabricpool["FabricPool不支持的功能或特性"^]。



TIP: Cloud Tiering 支持FlexVol和FlexGroup卷。



=== 发现ONTAP集群

您需要先将本地ONTAP系统添加到控制台，然后才能开始分层冷数据。

https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["了解如何发现集群"^]。



=== 准备与 S3 兼容的对象存储

与 S3 兼容的对象存储必须满足以下要求。

[[preparing-s3-compatible-object-storage]]
S3 凭证:: 当您设置分层到与 S3 兼容的对象存储时，系统会提示您创建 S3 存储桶或选择现有的 S3 存储桶。您需要向 Cloud Tiering 提供 S3 访问密钥和密钥。  Cloud Tiering 使用密钥来访问您的存储桶。
+
--
这些访问密钥必须与具有以下权限的用户相关联：

[source, json]
----
"s3:ListAllMyBuckets",
"s3:ListBucket",
"s3:GetObject",
"s3:PutObject",
"s3:DeleteObject",
"s3:CreateBucket"
----
--




=== 创建或切换代理

需要控制台代理将数据分层到云端。将数据分层到与 S3 兼容的对象存储时，您的场所必须有代理可用。您需要安装新的代理或确保当前选择的代理位于本地。

* https://docs.netapp.com/us-en/bluexp-setup-admin/concept-connectors.html["了解代理"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-install-connector-on-prem.html["在本地安装和设置代理"^]
* https://docs.netapp.com/us-en/bluexp-setup-admin/task-manage-multiple-connectors.html#switch-between-connectors["在代理之间切换"^]




=== 为控制台代理准备网络

确保代理具有所需的网络连接。

.步骤
. 确保安装代理的网络启用以下连接：
+
** 通过端口 443 建立到 Cloud Tiering 服务的 HTTPS 连接(https://docs.netapp.com/us-en/bluexp-setup-admin/task-set-up-networking-on-prem.html#endpoints-contacted-for-day-to-day-operations["查看端点列表"^]）
** 通过端口 443 建立与 S3 兼容的对象存储的 HTTPS 连接
** 通过端口 443 建立到ONTAP集群管理 LIF 的 HTTPS 连接






== 将第一个集群中的非活动数据分层到与 S3 兼容的对象存储

准备好环境后，开始从第一个集群中分层非活动数据。

.你需要什么
* https://docs.netapp.com/us-en/bluexp-ontap-onprem/task-discovering-ontap.html["已将本地系统添加到NetApp Console"^]。
* S3 兼容对象存储服务器的 FQDN 和将用于 HTTPS 通信的端口。
* 具有所需 S3 权限的访问密钥和密钥。


.步骤
. 选择本地ONTAP系统。
. 单击右侧面板中的“启用”以启用云分层服务。
+
image:screenshot_setup_tiering_onprem.png["屏幕截图显示了选择本地ONTAP系统后屏幕右侧出现的分层选项。"]

. *定义对象存储名称*：输入此对象存储的名称。它必须与您可能在此集群上与聚合一起使用的任何其他对象存储不同。
. *选择提供商*：选择*S3 兼容*并选择*继续*。
. 完成*创建对象存储*页面上的步骤：
+
.. *服务器*：输入与 S3 兼容的对象存储服务器的 FQDN、 ONTAP应使用 HTTPS 与服务器进行通信的端口，以及具有所需 S3 权限的帐户的访问密钥和密钥。
.. *存储桶*：添加一个新的存储桶或选择一个现有的存储桶，然后选择*继续*。
.. *集群网络*：选择ONTAP应用于连接对象存储的 IP 空间，然后选择*继续*。
+
选择正确的 IP 空间可确保 Cloud Tiering 可以建立从ONTAP到 S3 兼容对象存储的连接。

+
您还可以通过定义“最大传输速率”来设置可用于将非活动数据上传到对象存储的网络带宽。选择*Limited*单选按钮并输入可使用的最大带宽，或选择*Unlimited*表示没有限制。



. 在“成功”页面上选择“继续”立即设置您的卷。
. 在“Tier Volumes”页面上，选择要配置分层的卷，然后选择“继续”：
+
** 要选择所有卷，请选中标题行中的复选框（image:button_backup_all_volumes.png[""] ) 并选择 *配置卷*。
** 要选择多个卷，请选中每个卷对应的复选框（image:button_backup_1_volume.png[""] ) 并选择 *配置卷*。
** 要选择单个卷，请选择行（或image:screenshot_edit_icon.gif["编辑铅笔图标"]图标）来表示音量。
+
image:screenshot_tiering_initial_volumes.png["屏幕截图显示了如何选择单个卷、多个卷或所有卷以及修改选定卷按钮。"]



. 在“分层策略”对话框中，选择分层策略，选择性地调整所选卷的冷却天数，然后选择“应用”。
+
link:concept-cloud-tiering.html#volume-tiering-policies["了解有关容量分层策略和冷却天数的更多信息"]。

+
image:screenshot_tiering_initial_policy_settings.png["显示可配置分层策略设置的屏幕截图。"]



.下一步是什么？
link:task-licensing-cloud-tiering.html["请务必订阅 Cloud Tiering 服务"]。

您可以查看有关集群上活动和非活动数据的信息。link:task-managing-tiering.html["了解有关管理分层设置的更多信息"] 。

如果您希望将数据从集群上的某些聚合分层到不同的对象存储，您还可以创建额外的对象存储。或者，如果您计划使用FabricPool Mirroring，将分层数据复制到其他对象存储。link:task-managing-object-storage.html["了解有关管理对象存储的更多信息"] 。
